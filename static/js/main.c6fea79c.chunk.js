(this["webpackJsonproom-escape"]=this["webpackJsonproom-escape"]||[]).push([[0],{32:function(t,e,n){},44:function(t,e,n){},45:function(t,e,n){"use strict";n.r(e);var a=n(8),o=n.n(a),i=n(22),s=n.n(i),r=(n(32),n(19)),c=n(14),l=n(7),d=n(3),u=n(4),m=n(6),h=n(5),f=n(15),b=n(24),v=n.n(b),g=n(28),j=(n(42),n(11)),p=n(10),O=function(t){Object(m.a)(n,t);var e=Object(h.a)(n);function n(){var t;return Object(d.a)(this,n),(t=e.call(this)).dragStartHandler=function(e){t.setState(Object(l.a)(Object(l.a)({},t.state),{},{lastInvCoords:{x:e.target.attrs.x,y:e.target.attrs.y}}))},t.dragEndHandler=function(e,n){var a=t.refs[e.id].parent;t.refs[e.id].position(t.state.lastInvCoords);var o=t.getInventorySlotForCoords(n.target.getStage().getPointerPosition());null!==o&&t.props.items.length>o?t.props.onCombineItems(e,t.props.items[o]):t.props.onDragEnd(e.interactions,n.target.getStage().getPointerPosition()),a.draw()},t.getInventorySlotForCoords=function(e){var n=e.x,a=e.y,o=Math.ceil((n-5)/50),i=Math.ceil((a-510)/50);if(o<1||o>10||i<1)return null;var s=10*(i-1)+(o-1);return s>=t.props.maxInventorySlots?null:s},t.renderInventorySlot=function(t,e){return Object(p.jsx)(f.e,{x:5+e%10*50,y:515+50*Math.floor(e/10),width:40,height:40,fill:"grey",shadowBlur:10,shadowOpacity:.4},e)},t.renderInventoryItem=function(e,n){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e&&(a||n!==t.state.hoveredIdx))return Object(p.jsx)(f.b,{ref:e.id,x:5+n%10*50,y:515+50*Math.floor(n/10),width:40,height:40,image:e.image,draggable:!0,onMouseDown:t.dragStartHandler,onDragStart:t.dragStartHandler,onDragEnd:t.dragEndHandler.bind(Object(j.a)(t),e),onClick:t.props.onClick.bind(Object(j.a)(t),e),onTap:t.props.onClick.bind(Object(j.a)(t),e),onMouseOver:function(){t.setState(Object(l.a)(Object(l.a)({},t.state),{},{hoveredIdx:n}))}},e.id)},t.state={lastInvCoords:{x:0,y:0},hoveredIdx:0},t}return Object(u.a)(n,[{key:"render",value:function(){var t,e=this;return Object(p.jsxs)(f.c,{className:"inventoryLayer",children:[Object(p.jsx)(f.e,{x:0,y:510,width:500,height:50*Math.ceil(this.props.maxInventorySlots/10),fill:"dimgray",shadowBlur:10}),Object(c.a)(Array(parseInt(this.props.maxInventorySlots)).keys()).map(this.renderInventorySlot),null===(t=this.props.items)||void 0===t?void 0:t.map((function(t,n){return e.renderInventoryItem(t,n)})),this.props.items.length>0&&this.renderInventoryItem(this.props.items[this.state.hoveredIdx],this.state.hoveredIdx,!0)]})}}]),n}(a.Component),I=n(26),y=function(t){Object(m.a)(n,t);var e=Object(h.a)(n);function n(){var t;return Object(d.a)(this,n),(t=e.call(this))._clickHandler=function(e,n){t.props.onClick(t.state.items[e]),t.setState((function(t){return Object(l.a)(Object(l.a)({},t),{},{dotX:n.x,dotY:n.y})}))},t._hoverHandler=function(e){t.setState((function(t){return Object(l.a)(Object(l.a)({},t),{},{hoveredItem:e})}))},t._hoverEndHandler=function(e,n){t.setState((function(t){return Object(l.a)(Object(l.a)({},t),{},{hoveredItem:null})}))},t._mouseUpHandler=function(e,n){t.props.onMouseUp(e,n.target.getStage().getPointerPosition()),t.setState(Object(l.a)(Object(l.a)({},t.state),{},{dotX:n.evt.clientX,dotY:n.evt.clientY}))},t.renderClickableItem=function(e){var n=t.state.items[e];if(n)return Object(p.jsx)(f.d,{points:n.position.points,x:n.position.offsetX,y:n.position.offsetY,opacity:t.state.hoveredItem===e?.2:0,fill:"orange",closed:!0,onClick:function(n){return t._clickHandler(e,{x:n.evt.clientX,y:n.evt.clientY})},onTap:function(n){return t._clickHandler(e,n.target.getStage().getPointerPosition())},onMouseover:t._hoverHandler.bind(Object(j.a)(t),e),onMouseleave:t._hoverEndHandler.bind(Object(j.a)(t),e),onTouchEnd:t._mouseUpHandler.bind(Object(j.a)(t),e),onMouseUp:t._mouseUpHandler.bind(Object(j.a)(t),e)},e)},t.state={dotX:-10,dotY:-10,hoveredItem:null,image:null,items:{}},t}return Object(u.a)(n,[{key:"componentDidMount",value:function(){var t=this;I(this.props.config).then((function(t){return t.text()})).then((function(e){t.setState((function(t){return Object(l.a)(Object(l.a)({},t),{},{items:v.a.parse(e)})}))}));var e=new window.Image;e.src="images/".concat(this.props.bgImage),e.onload=function(){t.setState(Object(l.a)(Object(l.a)({},t.state),{},{image:e}))}}},{key:"render",value:function(){return this.state?Object(p.jsxs)(f.c,{className:"imgLayer",children:[Object(p.jsx)(f.b,{x:0,y:0,width:500,height:500,image:this.state.image}),Object(p.jsx)(f.a,{x:this.state.dotX,y:this.state.dotY,radius:"4",fill:"red"}),Object.keys(this.state.items).map(this.renderClickableItem)]}):null}}]),n}(a.Component),x=(n(44),n.p+"static/media/room1.8ab027f1.yaml"),S=n.p+"static/media/room2.c6fee66f.yaml",k=n.p+"static/media/items.69ffdaad.yaml",_=n(26),H=function(t){Object(m.a)(n,t);var e=Object(h.a)(n);function n(){var t;return Object(d.a)(this,n),(t=e.call(this))._handleLostItems=function(e){var n=e.itemsLost;if(!n||0===n.length)return!1;var a=t.state.inventoryItems.filter((function(t){return!n.includes(t.id)}));return t.setState(Object(l.a)(Object(l.a)({},t.state),{},{inventoryItems:a,usedItemIds:[].concat(Object(c.a)(t.state.usedItemIds),Object(c.a)(n))})),!0},t._handleHiddenItems=function(e){if(!e.itemsGained)return!1;var n,a=!1,o=Object(r.a)(e.itemsGained);try{var i=function(){var e=n.value;if(!t.playerHasLooted(e)&&t.state.itemInfo[e]){a=!0;var o=t.state.itemInfo[e],i=new window.Image;i.src="images/".concat(o.id,".png"),i.onload=function(){t.setState(Object(l.a)(Object(l.a)({},t.state),{},{inventoryItems:[].concat(Object(c.a)(t.state.inventoryItems),[Object(l.a)(Object(l.a)({},o),{},{image:i})]),flags:[].concat(Object(c.a)(t.state.flags),["".concat(e,"_obtained")])}))}}};for(o.s();!(n=o.n()).done;)i()}catch(s){o.e(s)}finally{o.f()}return a},t._handleRoomTransitions=function(e){var n=e.newRoom;return!!n&&(t.setState(Object(l.a)(Object(l.a)({},t.state),{},{room:n})),!0)},t._handleFlagsSet=function(e){var n,a=null===(n=e.flagsSet)||void 0===n?void 0:n.filter((function(e){return!t.state.flags.includes(e)}));return(null===a||void 0===a?void 0:a.length)>0&&(t.setState(Object(l.a)(Object(l.a)({},t.state),{},{flags:[].concat(Object(c.a)(t.state.flags),Object(c.a)(a))})),!0)},t._handleLocks=function(e){if(e.code){var n,a=e.unlocks.map((function(t){return"".concat(t,"_unlocked")})),o=Object(r.a)(a);try{for(o.s();!(n=o.n()).done;){var i=n.value;if(t.state.flags.includes(i))return}}catch(s){o.e(s)}finally{o.f()}t.setState(Object(l.a)(Object(l.a)({},t.state),{},{activeLock:{code:e.code,onUnlock:function(){t.setState(Object(l.a)(Object(l.a)({},t.state),{},{flags:[].concat(Object(c.a)(t.state.flags),Object(c.a)(a))}))}}}))}},t._getValidInteractions=function(e,n){var a;return null===e||void 0===e||null===(a=e.filter((function(t){return t.type===n})))||void 0===a?void 0:a.filter((function(e){return!e.requiredFlags||0===e.requiredFlags.filter((function(e){return!t.state.flags.includes(e)})).length}))},t._getImagePreviewUrl=function(t){var e="images/".concat(t,".png"),n=new Image;return n.src=e,0===n.width?"":e},t.reset=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";t.setState(Object(l.a)(Object(l.a)({},t.state),{},{imagePreviewUrl:t._getImagePreviewUrl(e),activeLock:{code:"",onUnlock:function(){}}}))},t.itemClickHandler=function(e){var n;t.reset(null===e||void 0===e?void 0:e.id);var a=!1;null===(n=t._getValidInteractions(e.interactions,"click"))||void 0===n||n.forEach((function(e){a=!0,t.setState(Object(l.a)(Object(l.a)({},t.state),{},{text:e.text})),t._handleHiddenItems(e),t._handleLostItems(e),t._handleFlagsSet(e),t._handleRoomTransitions(e),t._handleLocks(e)})),a||t.setState(Object(l.a)(Object(l.a)({},t.state),{},{text:e.description}))},t.logLastMouseUp=function(e,n){var a=n.x,o=n.y;t.setState(Object(l.a)(Object(l.a)({},t.state),{},{lastMouseUp:{itemId:e,x:a,y:o}}))},t.itemDragHandler=function(e,n){var a,o=n.x,i=n.y;t.reset();var s=!1;null===(a=t._getValidInteractions(e,"drag"))||void 0===a||a.forEach((function(e){e.target===t.state.lastMouseUp.itemId&&o===t.state.lastMouseUp.x&&i===t.state.lastMouseUp.y&&(t.setState(Object(l.a)(Object(l.a)({},t.state),{},{text:e.text})),s=!0,t._handleHiddenItems(e),t._handleLostItems(e),t._handleFlagsSet(e))})),s||t.setState(Object(l.a)(Object(l.a)({},t.state),{},{text:"Nothing happens."}))},t.combineItemsHandler=function(e,n){var a;t.reset();var o=!1;null===(a=t._getValidInteractions(e.interactions,"drag"))||void 0===a||a.forEach((function(e){e.target===n.id&&(t.setState(Object(l.a)(Object(l.a)({},t.state),{},{text:e.text})),o=!0,t._handleHiddenItems(e),t._handleLostItems(e),t._handleFlagsSet(e))})),o||t.setState(Object(l.a)(Object(l.a)({},t.state),{},{text:"Nothing happens."}))},t.state={maxInventorySlots:10,inventoryItems:[],usedItemIds:[],itemInfo:{},text:"",lastMouseUp:{itemId:null,x:0,y:0},room:"room1",flags:[],imagePreviewUrl:"",activeLock:{code:"",onUnlock:function(){}}},t.configMap={room1:x,room2:S},t}return Object(u.a)(n,[{key:"componentDidMount",value:function(){var t=this;_(k).then((function(t){return t.text()})).then((function(e){t.setState((function(t){return Object(l.a)(Object(l.a)({},t),{},{itemInfo:v.a.parse(e)})}))}))}},{key:"playerHasLooted",value:function(t){return this.state.inventoryItems.map((function(t){return t.id})).includes(t)||this.state.usedItemIds.includes(t)}},{key:"render",value:function(){return Object(p.jsxs)("div",{className:"App",children:[Object(p.jsxs)(f.f,{className:"canvas",width:"500",height:"1000",children:[Object(p.jsx)(y,{config:this.configMap[this.state.room],bgImage:"".concat(this.state.room,".png"),onClick:this.itemClickHandler,onMouseUp:this.logLastMouseUp},this.state.room),Object(p.jsx)(O,{items:this.state.inventoryItems,maxInventorySlots:this.state.maxInventorySlots,onClick:this.itemClickHandler,onDragEnd:this.itemDragHandler,onCombineItems:this.combineItemsHandler})]}),Object(p.jsxs)("header",{className:"App-header",style:{display:"flex",flexDirection:"column"},children:[this.state.text,Object(p.jsx)("img",{src:this.state.imagePreviewUrl,style:{width:"70%",marginTop:"20px"}}),Object(p.jsx)("div",{style:{color:"black",display:this.state.activeLock.code?"block":"none"},children:Object(p.jsx)(g.a,{combination:"".concat(this.state.activeLock.code),onMatch:this.state.activeLock.onUnlock,openText:"Unlocked!"})})]})]})}}]),n}(a.Component),w=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,47)).then((function(e){var n=e.getCLS,a=e.getFID,o=e.getFCP,i=e.getLCP,s=e.getTTFB;n(t),a(t),o(t),i(t),s(t)}))};s.a.render(Object(p.jsx)(o.a.StrictMode,{children:Object(p.jsx)(H,{})}),document.getElementById("root")),w()}},[[45,1,2]]]);
//# sourceMappingURL=main.c6fea79c.chunk.js.map